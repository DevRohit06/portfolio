---
/**
 * BlogJsonLd - A component for adding structured data to blog posts
 * Uses JSON-LD format following schema.org BlogPosting schema
 * https://schema.org/BlogPosting
 */

interface Props {
  title: string;
  description: string;
  publishDate: Date;
  updatedDate?: Date;
  authorName?: string;
  authorUrl?: string;
  heroImage?: string;
  tags?: string[];
  canonicalUrl: string;
  readingTime?: number;
  wordCount?: number;
}

const siteUrl = Astro.site?.toString().replace(/\/$/, "") || "https://rohitk06.in";

const {
  title,
  description,
  publishDate,
  updatedDate,
  authorName = "Rohit Kushwaha",
  authorUrl = siteUrl,
  heroImage,
  tags = [],
  canonicalUrl,
  readingTime,
  wordCount,
} = Astro.props;

// Format dates for structured data
const formattedPubDate = new Date(publishDate).toISOString();
const formattedUpdatedDate = updatedDate
  ? new Date(updatedDate).toISOString()
  : formattedPubDate;

// Construct the JSON-LD structured data
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  headline: title,
  description: description,
  image: heroImage || `${siteUrl}/images/og.webp`,
  datePublished: formattedPubDate,
  dateModified: formattedUpdatedDate,
  author: {
    "@type": "Person",
    name: authorName,
    url: authorUrl,
  },
  publisher: {
    "@type": "Organization",
    name: "Rohit Kushwaha",
    url: siteUrl,
    logo: {
      "@type": "ImageObject",
      url: `${siteUrl}/images/rohit.webp`,
    },
  },
  mainEntityOfPage: {
    "@type": "WebPage",
    "@id": canonicalUrl,
  },
  keywords: Array.isArray(tags) ? tags.join(", ") : "",
  ...(wordCount ? { wordCount } : {}),
  timeRequired: readingTime ? `PT${readingTime}M` : "PT5M",
  inLanguage: "en-US",
};

// Breadcrumb structured data for blog navigation
const breadcrumbLd = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    {
      "@type": "ListItem",
      position: 1,
      name: "Home",
      item: siteUrl,
    },
    {
      "@type": "ListItem",
      position: 2,
      name: "Blog",
      item: `${siteUrl}/blogs`,
    },
    {
      "@type": "ListItem",
      position: 3,
      name: title,
      item: canonicalUrl,
    },
  ],
};
---

<!-- Render the JSON-LD structured data -->
<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbLd)} />
