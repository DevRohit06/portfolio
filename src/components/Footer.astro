---
import { Image } from "astro:assets";
import dialogh from "../assets/dialogh-typo.png";
import Badge from "./Badge.astro";
import { socials } from "../lib/socials";
---

<footer id="footer" class="footer-section mt-20 mb-2">
  <div
    class="footer-container w-[90%] md:w-[80%] lg:w-[70%] mx-auto border border-[#7B7B7B] opacity-0 invisible footer-scroll-reveal"
  >
    <!-- Grid containing all sections with their headings and links together -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 footer-grid">
      <!-- Column 1: Rohit Kushwaha -->
      <div
        class="footer-col p-4 sm:p-6 md:p-8 border-b sm:border-b-0 sm:border-r border-[#7B7B7B] footer-scroll-reveal"
        data-delay="0.1"
      >
        <h2
          class="footer-heading text-lg sm:text-xl font-medium mb-4 split-text"
        >
          Rohit Kushwaha
        </h2>
        <div class="flex flex-col gap-3 sm:gap-4 footer-links">
          <a
            href="/coming-soon"
            class="footer-link text-sm sm:text-base hover:text-[#0000CC] transition-colors duration-300 footer-magnetic-item"
            >About me</a
          >
          <a
            href="/coming-soon"
            class="footer-link text-sm sm:text-base hover:text-[#0000CC] transition-colors duration-300 footer-magnetic-item"
            >Experience</a
          >
          <a
            href="/blogs"
            class="footer-link text-sm sm:text-base hover:text-[#0000CC] transition-colors duration-300 footer-magnetic-item"
            >Blogs</a
          >
        </div>
      </div>

      <!-- Column 2: Contact & Socials -->
      <div
        class="footer-col p-4 sm:p-6 md:p-8 border-b sm:border-b-0 sm:border-r border-[#7B7B7B] footer-scroll-reveal"
        data-delay="0.2"
      >
        <h2 class="footer-heading text-lg sm:text-xl mb-4 split-text">
          Contact & Socials
        </h2>
        <div class="grid grid-cols-2 gap-x-2 gap-y-3 sm:gap-y-4 footer-links">
          <a
            href={socials.linkedIn}
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link footer-magnetic-item text-sm sm:text-base hover:text-[#0000CC] transition-colors duration-300"
            >LinkedIn</a
          >
          <a
            href={socials.discord}
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link footer-magnetic-item text-sm sm:text-base hover:text-[#0000CC] transition-colors duration-300"
            >Discord</a
          >
          <a
            href={socials.github}
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link footer-magnetic-item text-sm sm:text-base hover:text-[#0000CC] transition-colors duration-300"
            >GitHub</a
          >
          <a
            href={socials.instagram}
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link footer-magnetic-item text-sm sm:text-base hover:text-[#0000CC] transition-colors duration-300"
            >Instagram</a
          >
          <a
            href={socials.mail}
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link footer-magnetic-item text-sm sm:text-base hover:text-[#0000CC] transition-colors duration-300"
            >Mail</a
          >
          <a
            href={socials.twitter}
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link footer-magnetic-item text-sm sm:text-base hover:text-[#0000CC] transition-colors duration-300"
            >X [Twitter]</a
          >
        </div>
      </div>

      <!-- Column 3: Open Source Projects -->
      <div
        class="footer-col border-b sm:border-b-0 sm:border-r border-[#7B7B7B] footer-scroll-reveal"
        data-delay="0.3"
      >
        <div class="p-4 sm:p-6 md:p-8">
          <!-- <h3 class="footer-heading text-lg sm:text-xl font-medium split-text">
            Open Source
          </h3> -->
          <p class="footer-desc text-sm sm:text-base">Open Source on Github</p>
          <div class="mt-4 sm:mt-4 flex flex-col gap-3">
            <a
              href="https://github.com/devrohit06/portfolio/issues/new"
              class="footer-join-link footer-magnetic-item text-xs sm:text-sm text-[#0000CC] font-medium group flex items-center"
            >
              <span>Check Out</span>
              <span
                class="ml-1 group-hover:translate-x-1 transition-transform duration-300"
                >→</span
              >
            </a>
          </div>
        </div>
        <div class="border-t border-[#7B7B7B] p-4 sm:p-6 md:p-8">
          <div class="flex flex-col gap-3">
            <h3 class="text-base sm:text-lg font-medium">Contribute</h3>
            <p class="text-xs sm:text-sm text-[#4B4B4B] mb-2">
              Want to contribute to this project?
            </p>
            <div class="flex justify-between items-center">
              <a
                href="https://github.com/devrohit06/portfolio/fork"
                class="footer-link-subtle text-xs sm:text-sm text-[#5C5C5C] hover:text-[#7B7B7B] transition-colors duration-300"
                >Fork this repo</a
              >
              <a
                href="https://github.com/devrohit06/portfolio/issues/new"
                class="footer-join-link footer-magnetic-item text-xs sm:text-sm text-[#0000CC] font-medium group flex items-center"
              >
                <span>Create Issue</span>
                <span
                  class="ml-1 group-hover:translate-x-1 transition-transform duration-300"
                  >→</span
                >
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Column 4: Core Team -->
      <div
        class="footer-col p-4 sm:p-6 md:p-8 border-b sm:border-b-0 sm:border-r border-[#7B7B7B] footer-scroll-reveal"
        data-delay="0.3"
      >
        <div
          class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mb-4 footer-dialogh-header"
        >
          <div class="footer-logo">
            <Image src={dialogh} class="h-6 sm:h-8 w-fit" alt="dialogh" />
          </div>
          <div class="footer-badge">
            <Badge text="TECH COMMUNITY" size="sm" />
          </div>
        </div>
        <p class="footer-desc text-sm sm:text-base">
          Tech is ever-evolving, and so are we. So why not create a space where
          we can all grow alongside the tech we use and care about?
        </p>
        <div
          class="mt-4 sm:mt-6 flex justify-between items-center footer-dialogh-links"
        >
          <a
            href="https://dialogh.in"
            class="footer-link-subtle text-xs sm:text-sm text-[#5C5C5C]"
            >dialogh.in</a
          >
          <a
            href="https://dialogh.in"
            class="footer-join-link footer-magnetic-item text-xs sm:text-sm text-[#0000CC] font-medium"
            >Join Now →</a
          >
        </div>
      </div>
    </div>

    <!-- Copyright row -->
    <div
      class="footer-copyright border-t border-[#7B7B7B] p-3 sm:p-4 flex justify-between items-center footer-scroll-reveal"
      data-delay="0.4"
    >
      <span class="footer-copyright-text text-xs sm:text-sm"
        >© Rohit Kushwaha</span
      >
      <a
        href="https://rohitk06.dev"
        class="footer-website-link text-xs sm:text-sm flex items-center group footer-magnetic-item"
      >
        <span class="mr-1">rohitk06.dev</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-3 w-3 sm:h-4 sm:w-4 transition-transform duration-300 group-hover:rotate-12"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064"
          ></path>
        </svg>
      </a>
    </div>
  </div>
</footer>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  import {
    createMagneticEffect,
    scrollTextReveal,
    createScene,
    scaleIn,
  } from "../utils/animations.js";

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("DOMContentLoaded", () => {
    const footerSection = document.querySelector(".footer-section");
    const footerContainer = document.querySelector(".footer-container");
    if (!footerSection || !footerContainer) return;

    // Set initial state for elements with enhanced animations
    gsap.set(".footer-scroll-reveal", {
      opacity: 0,
      scale: 0.85,
    });

    // Create a scroll trigger for the footer animation with better threshold
    ScrollTrigger.create({
      trigger: footerSection,
      start: "top 85%", // Trigger earlier
      once: true, // Only trigger once
      onEnter: () => animateFooter(),
    });

    function animateFooter() {
      // Make footer visible first before animations start
      gsap.set(footerContainer, {
        clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)",
        opacity: 1,
        visibility: "visible", // Make visible when animation starts
      });

      // Create advanced reveal effect with clipPath
      gsap.to(".footer-container", {
        clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
        duration: 1.2,
        ease: "expo.inOut",
      });

      // Process text for character-by-character animation
      const splitTextElements = document.querySelectorAll(".split-text");
      splitTextElements.forEach((element) => {
        const text = element.textContent || "";
        let htmlContent = "";

        // Create spans for each character for advanced text animation
        for (let i = 0; i < text.length; i++) {
          if (text[i] === " ") {
            htmlContent += '<span class="char-span">&nbsp;</span>';
          } else {
            htmlContent += `<span class="char-span">${text[i]}</span>`;
          }
        }

        element.innerHTML = htmlContent;
      });

      // Animate text characters with stagger
      gsap.from(
        ".footer-heading .char-span",
        {
          opacity: 0,
          y: 20,
          stagger: 0.02,
          duration: 0.6,
          ease: "back.out(1.5)",
        },
        "-=0.6"
      );

      // Create scroll-triggered animations for each card with staggered reveal
      const elements = document.querySelectorAll(".footer-scroll-reveal");
      elements.forEach((element) => {
        const delay = element.getAttribute("data-delay")
          ? parseFloat(element.getAttribute("data-delay"))
          : 0;

        gsap.to(element, {
          opacity: 1,
          scale: 1,
          duration: 1.2,
          delay: delay,
          ease: "back.out(1.5)",
          clearProps: "transform",
        });

        // Add a subtle glow effect
        gsap.fromTo(
          element,
          { boxShadow: "0 0 0 rgba(0, 0, 204, 0)" },
          {
            boxShadow:
              "0 5px 20px rgba(0, 0, 204, 0.15), 0 0 0 rgba(0, 0, 204, 0)",
            duration: 1.5,
            delay: delay + 0.2,
            clearProps: "boxShadow",
          }
        );
      });

      // Add magnetic effect to links
      createMagneticEffect(".footer-magnetic-item", 0.3);

      // Create scene for advanced animations
      createScene(
        ".footer-container",
        [
          {
            element: ".footer-col",
            props: {
              x: 0,
              rotation: 0,
              transformOrigin: "center center",
            },
          },
          {
            element: ".footer-copyright",
            props: {
              x: 0,
              rotation: 0,
              transformOrigin: "center center",
            },
            position: "-=0.3",
          },
        ],
        {
          start: "top 60%",
          end: "bottom 40%",
          scrub: true,
          markers: false,
        }
      );

      // Add hover effects like those in Bento.astro
      const footerCols = document.querySelectorAll(".footer-col");
      footerCols.forEach((col) => {
        col.addEventListener("mouseenter", () => {
          gsap.to(col, {
            scale: 1.02,
            boxShadow: "0 15px 35px rgba(0, 0, 0, 0.15)",
            y: -5,
            duration: 0.4,
            ease: "power2.out",
          });

          const rect = col.getBoundingClientRect();
          const cardCenterX = rect.left + rect.width / 2;
          const windowCenterX = window.innerWidth / 2;
          const rotationY = (cardCenterX - windowCenterX) * 0.01;

          gsap.to(col, {
            rotationY: rotationY,
            rotationX: -2,
            duration: 0.4,
            ease: "power2.out",
          });
        });

        col.addEventListener("mousemove", (e) => {
          const rect = col.getBoundingClientRect();
          const mouseX = e.clientX - rect.left;
          const mouseY = e.clientY - rect.top;

          const centerX = rect.width / 2;
          const centerY = rect.height / 2;

          const rotateY = (mouseX - centerX) / 30;
          const rotateX = (centerY - mouseY) / 30;

          gsap.to(col, {
            rotateY: rotateY,
            rotateX: rotateX,
            duration: 0.3,
            ease: "power2.out",
          });
        });

        col.addEventListener("mouseleave", () => {
          gsap.to(col, {
            scale: 1,
            boxShadow: "none",
            y: 0,
            rotateX: 0,
            rotateY: 0,
            duration: 0.7,
            ease: "elastic.out(1, 0.5)",
          });
        });
      });
    }

    // Add parallax scroll effect
    ScrollTrigger.create({
      trigger: footerSection,
      start: "top bottom",
      end: "bottom bottom",
      scrub: true,
      onUpdate: (self) => {
        const yPos = (1 - self.progress) * 30; // Move up as it enters viewport
        gsap.to(".footer-container", {
          y: yPos,
          ease: "none",
          overwrite: "auto",
        });
      },
    });
  });
</script>

<style>
  .footer-section {
    position: relative;
    will-change: transform;
  }

  .footer-container {
    will-change: transform, clip-path, opacity, visibility;
  }

  .footer-scroll-reveal {
    will-change: transform, opacity;
    transition: box-shadow 0.3s ease;
  }

  .char-span {
    display: inline-block;
    will-change: transform, opacity;
  }

  .footer-logo img {
    will-change: transform;
    transition: transform 0.3s ease;
  }

  .footer-logo:hover img {
    transform: scale(1.1);
  }

  /* Add subtle hover effect on card borders like in Bento */
  .footer-col {
    position: relative;
    overflow: hidden;
    will-change: transform;
  }

  .footer-col:hover::before {
    opacity: 0.5;
  }

  .footer-col::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(0, 0, 204, 0.3),
      transparent
    );
    opacity: 0;
    transition: opacity 0.5s;
  }

  .footer-col:hover::after {
    opacity: 1;
  }

  @media (prefers-reduced-motion: reduce) {
    .footer-container {
      opacity: 1;
      clip-path: none;
    }

    .footer-scroll-reveal {
      transition: none !important;
      transform: none !important;
    }
  }
</style>
