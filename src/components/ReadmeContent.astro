---
// ReadmeContent component for rendering GitHub README markdown with syntax highlighting
// Uses Astro's Markdown component which includes Shiki syntax highlighting

interface Props {
  content: string; // Raw markdown string from GitHub README
}

const { content } = Astro.props;
---

<div class="blog-content prose prose-lg max-w-none">
  <Fragment set:html={content} />
</div>

<style is:global>
  .blog-content {
    color: var(--text-primary);
  }

  /* Heading styles */
  .blog-content h1,
  .blog-content h2,
  .blog-content h3,
  .blog-content h4,
  .blog-content h5,
  .blog-content h6 {
    margin-top: 2em;
    margin-bottom: 0.5em;
    position: relative;
    color: var(--text-primary);
  }

  .blog-content h1 {
    font-size: 2rem;
    font-weight: 700;
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 0.5em;
  }

  .blog-content h2 {
    font-size: 1.75rem;
    font-weight: 600;
    border-bottom: 1px solid rgba(var(--text-secondary-rgb), 0.3);
    padding-bottom: 0.3em;
  }

  .blog-content h3 {
    font-size: 1.35rem;
    font-weight: 600;
  }

  .blog-content h4 {
    font-size: 1.15rem;
    font-weight: 600;
  }

  /* Paragraph styles */
  .blog-content p {
    margin-bottom: 1.5em;
    line-height: 1.7;
    color: var(--text-primary);
  }

  /* Link styles */
  .blog-content a {
    color: var(--accent-primary);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .blog-content a:hover {
    color: var(--accent-secondary);
  }

  /* Image styles */
  .blog-content img {
    border: 1px solid var(--border-color);
    margin: 1.5em 0;
    max-width: 100%;
    height: auto;
  }

  /* Code block styles - Shiki generates pre with class="shiki" */
  .blog-content pre {
    padding: 1em;
    overflow-x: auto;
    border-radius: 0;
  }

  /* Shiki handles theme switching via CSS - we support light and dark */
  .blog-content pre.shiki,
  .blog-content pre.shiki span {
    color: var(--shiki-light);
    background-color: var(--shiki-light-bg);
  }

  .dark-theme .blog-content pre.shiki,
  .dark-theme .blog-content pre.shiki span {
    color: var(--shiki-dark);
    background-color: var(--shiki-dark-bg);
  }

  /* Inline code styles */
  .blog-content code {
    background-color: rgba(var(--text-secondary-rgb), 0.1);
    padding: 0.2em 0.4em;
    font-size: 0.9em;
    font-family: "Courier New", monospace;
    color: var(--text-primary);
    border-radius: 0;
  }

  /* Remove background from code inside pre (styled by Shiki) */
  .blog-content pre code {
    background-color: transparent;
    padding: 0;
  }

  /* Preserve syntax highlighting colors from Shiki */
  .blog-content pre code span {
    color: inherit;
  }

  /* Blockquote styles */
  .blog-content blockquote {
    border-left: 4px solid var(--accent-primary);
    padding-left: 1em;
    margin-left: 0;
    font-style: italic;
    background-color: rgba(var(--accent-primary-rgb), 0.05);
    padding: 1em 1.2em;
    color: var(--text-secondary);
  }

  /* List styles */
  .blog-content ul,
  .blog-content ol {
    margin-bottom: 1.5em;
    padding-left: 1.5em;
    color: var(--text-primary);
  }

  .blog-content li {
    margin-bottom: 0.5em;
  }

  .blog-content ul {
    list-style-type: disc;
  }

  .blog-content ol {
    list-style-type: decimal;
  }

  /* Strong and emphasis */
  .blog-content strong {
    font-weight: 600;
    color: var(--text-primary);
  }

  .blog-content em {
    font-style: italic;
  }

  /* Horizontal rule */
  .blog-content hr {
    border: none;
    border-top: 1px solid var(--border-color);
    margin: 2em 0;
  }

  /* Table styles - Responsive */
  .blog-content .table-wrapper {
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    margin: 2em 0;
    border: 1px solid var(--border-color);
  }

  .blog-content table {
    width: 100%;
    min-width: 600px;
    border-collapse: collapse;
    background: var(--bg-secondary);
  }

  .blog-content th,
  .blog-content td {
    padding: 0.85em 1.2em;
    border-bottom: 1px solid var(--border-color);
    text-align: left;
    color: var(--text-primary);
    white-space: nowrap;
  }

  .blog-content th {
    background: var(--bg-primary);
    color: var(--accent-primary);
    font-weight: 600;
    font-size: 1.05em;
    border-bottom: 2px solid var(--border-color);
    position: sticky;
    top: 0;
  }

  .blog-content tr:last-child td {
    border-bottom: none;
  }

  .blog-content tr:nth-child(even) td {
    background: rgba(var(--accent-primary-rgb), 0.03);
  }

  /* Mobile responsive adjustments for tables */
  @media (max-width: 768px) {
    .blog-content th,
    .blog-content td {
      padding: 0.65em 0.9em;
      font-size: 0.9em;
    }
  }

  /* Inline code in headings */
  .blog-content h1 code,
  .blog-content h2 code,
  .blog-content h3 code,
  .blog-content h4 code {
    font-size: 0.9em;
  }

  /* Mermaid diagram styles */
  .blog-content .mermaid {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    padding: 1.5em;
    margin: 1.5em 0;
    text-align: center;
    overflow-x: auto;
  }

  .blog-content .mermaid svg {
    max-width: 100%;
    height: auto;
  }
</style>

<script>
  // Wrap tables in a scrollable container for responsiveness
  function wrapTables() {
    const tables = document.querySelectorAll(".blog-content table");
    tables.forEach((table) => {
      // Check if table is already wrapped
      if (table.parentElement?.classList.contains("table-wrapper")) return;

      const wrapper = document.createElement("div");
      wrapper.className = "table-wrapper";
      table.parentNode?.insertBefore(wrapper, table);
      wrapper.appendChild(table);
    });
  }

  // Initialize mermaid for README content
  async function initMermaid() {
    const mermaidElements = document.querySelectorAll(".blog-content .mermaid");
    if (mermaidElements.length === 0) return;

    // Dynamically import mermaid
    const mermaid = (await import("mermaid")).default;

    // Detect current theme
    const isDark = document.documentElement.classList.contains("dark-theme");

    mermaid.initialize({
      startOnLoad: false,
      theme: isDark ? "dark" : "default",
      securityLevel: "loose",
      fontFamily: "inherit",
    });

    // Render each mermaid diagram
    mermaidElements.forEach(async (element, index) => {
      const code = element.textContent || "";
      if (code.trim()) {
        try {
          const { svg } = await mermaid.render(
            `mermaid-diagram-${index}`,
            code,
          );
          element.innerHTML = svg;
        } catch (error) {
          console.error("Mermaid rendering error:", error);
          element.innerHTML = `<pre style="color: red;">Error rendering diagram: ${error}</pre>`;
        }
      }
    });
  }

  // Combined initialization function
  function initReadmeContent() {
    wrapTables();
    initMermaid();
  }

  // Run on page load
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initReadmeContent);
  } else {
    initReadmeContent();
  }

  // Also run on Astro transitions
  document.addEventListener("astro:page-load", initReadmeContent);
</script>
