---
import { Image } from "astro:assets";
import dialogh from "../assets/dialogh-typo.png";
import Badge from "./Badge.astro";
import { socials } from "../lib/socials";
import SocialIcons from "./SocialIcons.astro";
import DiscordStatusCompact from "./svelte/discord/DiscordStatusCompact.svelte";
import { PUBLIC_DIALOGH_URL } from "astro:env/client";

const dialoghUrl = PUBLIC_DIALOGH_URL;
const siteUrl = Astro.site?.toString() || "https://rohitk06.in";
---

<footer id="footer" class="footer-section mt-20 mb-2">
  <div
    class="footer-container w-[95%] xs:w-[90%] sm:w-[85%] md:w-[80%] lg:w-[75%] xl:w-[70%] 2xl:w-[65%] mx-auto border border-[var(--border-color)] opacity-0 invisible footer-scroll-reveal"
  >
    <!-- Grid containing all sections with their headings and links together -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 footer-grid">
      <div
        class="footer-col p-4 sm:p-6 lg:p-8 border-b border-[var(--border-color)] sm:border-b lg:border-b-0 footer-scroll-reveal"
        data-delay="0.1"
      >
        <h2
          class="footer-heading text-base sm:text-lg lg:text-xl font-medium mb-3 sm:mb-4 split-text"
        >
          Rohit Kushwaha
        </h2>
        <div class="flex flex-col gap-2 sm:gap-3 lg:gap-4 footer-links">
          <a
            href="/coming-soon"
            class="footer-link text-sm sm:text-base hover:text-[var(--accent-primary)] footer-magnetic-item"
            >About me</a
          >
          <a
            href="/coming-soon"
            class="footer-link text-sm sm:text-base hover:text-[var(--accent-primary)] footer-magnetic-item"
            >Experience</a
          >
          <a
            href="/blogs"
            class="footer-link text-sm sm:text-base hover:text-[var(--accent-primary)] footer-magnetic-item"
            >Blogs</a
          >
        </div>
      </div>

      <div
        class="footer-col p-4 sm:p-6 lg:p-8 border-b border-[var(--border-color)] lg:border-b-0 footer-scroll-reveal"
        data-delay="0.2"
      >
        <h2
          class="footer-heading text-base sm:text-lg lg:text-xl mb-3 sm:mb-4 split-text"
        >
          Contact & Socials
        </h2>
        <div
          class="grid grid-cols-1 xs:grid-cols-2 gap-x-2 gap-y-2 sm:gap-y-3 lg:gap-y-4 footer-links"
        >
          <a
            href={socials.linkedIn}
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link footer-magnetic-item text-sm sm:text-base hover:text-[var(--accent-primary)]"
            >LinkedIn</a
          >
          <a
            href={socials.discord}
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link footer-magnetic-item text-sm sm:text-base hover:text-[var(--accent-primary)]"
            >Discord</a
          >
          <a
            href={socials.github}
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link footer-magnetic-item text-sm sm:text-base hover:text-[var(--accent-primary)]"
            >GitHub</a
          >
          <a
            href={socials.instagram}
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link footer-magnetic-item text-sm sm:text-base hover:text-[var(--accent-primary)]"
            >Instagram</a
          >
          <a
            href={socials.mail}
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link footer-magnetic-item text-sm sm:text-base hover:text-[var(--accent-primary)]"
            >Mail</a
          >
          <a
            href={socials.twitter}
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link footer-magnetic-item text-sm sm:text-base hover:text-[var(--accent-primary)]"
            >X [Twitter]</a
          >
        </div>
      </div>

      <div
        class="footer-col border-b border-[var(--border-color)] lg:border-b-0 footer-scroll-reveal"
        data-delay="0.3"
      >
        <div class="p-4 sm:p-6 lg:p-8">
          <p class="footer-desc text-sm sm:text-base">Open Source on Github</p>
          <div class="mt-3 sm:mt-4 flex flex-col gap-2 sm:gap-3">
            <a
              href="https://github.com/devrohit06/portfolio"
              class="footer-join-link footer-magnetic-item text-xs sm:text-sm text-[var(--accent-primary)] font-medium group flex items-center"
            >
              <span>Check Out</span>
              <span class="ml-1 group-hover:translate-x-1 transition-transform"
                >→</span
              >
            </a>
          </div>
        </div>
        <div class="border-t border-[var(--border-color)] p-4 sm:p-6 lg:p-8">
          <div class="flex flex-col gap-2 sm:gap-3">
            <h3 class="text-sm sm:text-base lg:text-lg font-medium">
              Contribute
            </h3>
            <p class="text-xs sm:text-sm text-[var(--text-secondary)] mb-2">
              Want to contribute to this project?
            </p>
            <div
              class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2"
            >
              <a
                href="https://github.com/devrohit06/portfolio/fork"
                class="footer-link-subtle text-xs sm:text-sm text-[var(--text-secondary)] hover:text-[var(--text-primary)]"
                >Fork this repo</a
              >
              <a
                href="https://github.com/devrohit06/portfolio/issues/new"
                class="footer-join-link footer-magnetic-item text-xs sm:text-sm text-[var(--accent-primary)] font-medium group flex items-center"
              >
                <span>Create Issue</span>
                <span
                  class="ml-1 group-hover:translate-x-1 transition-transform"
                  >→</span
                >
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Column 4: Core Team -->
      <div
        class="footer-col p-4 sm:p-6 lg:p-8 footer-scroll-reveal"
        data-delay="0.3"
      >
        <div
          class="flex flex-col xs:flex-row xs:items-center gap-2 sm:gap-3 lg:gap-4 mb-3 sm:mb-4 footer-dialogh-header"
        >
          <div class="footer-logo">
            <Image
              src={dialogh}
              class="h-5 sm:h-6 lg:h-8 w-fit dark:invert"
              alt="dialogh"
            />
          </div>
          <div class="footer-badge">
            <Badge text="TECH COMMUNITY" size="sm" />
          </div>
        </div>
        <p class="footer-desc text-sm sm:text-base mb-3 sm:mb-4 lg:mb-6">
          Tech is ever-evolving, and so are we. So why not create a space where
          we can all grow alongside the tech we use and care about?
        </p>
        <div
          class="flex flex-col xs:flex-row xs:justify-between xs:items-center gap-2 footer-dialogh-links"
        >
          <a
            href={dialoghUrl}
            class="footer-link-subtle text-xs sm:text-sm text-[var(--text-secondary)]"
            >dialogh.in</a
          >
          <a
            href={dialoghUrl}
            class="footer-join-link footer-magnetic-item text-xs sm:text-sm text-[var(--accent-primary)] font-medium"
            >Join Now →</a
          >
        </div>
      </div>
    </div>

    <!-- Copyright row with Discord Status -->
    <div
      class="footer-copyright border-t border-[var(--border-color)] flex flex-col sm:grid sm:grid-cols-12 footer-scroll-reveal"
      data-delay="0.4"
    >
      <div
        class="sm:col-span-4 md:col-span-3 lg:col-span-3 sm:pt-1 pt-2 border-b sm:border-b-0 border-[var(--border-color)] pb-2 sm:pb-0"
      >
        <DiscordStatusCompact client:load userId="743173584935190620" />
      </div>
      <div
        class="sm:col-span-8 md:col-span-9 lg:col-span-9 sm:border-l p-2 sm:p-3 lg:p-4 border-[var(--border-color)] flex items-center justify-between w-full"
      >
        <span class="footer-copyright-text text-xs sm:text-sm whitespace-nowrap"
          >© Rohit Kushwaha</span
        >

        <a
          href={siteUrl}
          class="footer-website-link text-xs sm:text-sm flex items-center group footer-magnetic-item whitespace-nowrap"
        >
          <span class="mr-1">rohitk06.in</span>
        </a>
      </div>
    </div>
  </div>
</footer>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  import {
    createMagneticEffect,
    scrollTextReveal,
    createScene,
    scaleIn,
  } from "../utils/animations.js";

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("DOMContentLoaded", () => {
    const footerSection = document.querySelector(".footer-section");
    const footerContainer = document.querySelector(".footer-container");
    if (!footerSection || !footerContainer) return;

    // Set initial state for elements with enhanced animations
    gsap.set(".footer-scroll-reveal", {
      opacity: 0,
      scale: 0.85,
    });

    // Create a scroll trigger for the footer animation with better threshold
    ScrollTrigger.create({
      trigger: footerSection,
      start: "top 85%", // Trigger earlier
      once: true, // Only trigger once
      onEnter: () => animateFooter(),
    });

    function animateFooter() {
      // Make footer visible first before animations start
      gsap.set(footerContainer, {
        clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)",
        opacity: 1,
        visibility: "visible", // Make visible when animation starts
      });

      // Create advanced reveal effect with clipPath
      gsap.to(".footer-container", {
        clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
        duration: 1.2,
        ease: "expo.inOut",
      });

      // Process text for character-by-character animation
      const splitTextElements = document.querySelectorAll(".split-text");
      splitTextElements.forEach((element) => {
        const text = element.textContent || "";
        let htmlContent = "";

        // Create spans for each character for advanced text animation
        for (let i = 0; i < text.length; i++) {
          if (text[i] === " ") {
            htmlContent += '<span class="char-span">&nbsp;</span>';
          } else {
            htmlContent += `<span class="char-span">${text[i]}</span>`;
          }
        }

        element.innerHTML = htmlContent;
      });

      // Animate text characters with stagger
      gsap.from(
        ".footer-heading .char-span",
        {
          opacity: 0,
          y: 20,
          stagger: 0.02,
          duration: 0.6,
          ease: "back.out(1.5)",
        },
        "-=0.6",
      );

      // Create scroll-triggered animations for each card with staggered reveal
      const elements = document.querySelectorAll(".footer-scroll-reveal");
      elements.forEach((element) => {
        const delay = element.getAttribute("data-delay")
          ? parseFloat(element.getAttribute("data-delay"))
          : 0;

        gsap.to(element, {
          opacity: 1,
          scale: 1,
          duration: 1.2,
          delay: delay,
          ease: "back.out(1.5)",
          clearProps: "transform",
        });

        // Add a subtle glow effect
        gsap.fromTo(
          element,
          { boxShadow: "0 0 0 rgba(0, 0, 204, 0)" },
          {
            boxShadow:
              "0 5px 20px rgba(0, 0, 204, 0.15), 0 0 0 rgba(0, 0, 204, 0)",
            duration: 1.5,
            delay: delay + 0.2,
            clearProps: "boxShadow",
          },
        );
      });

      // Add magnetic effect to links
      // createMagneticEffect(".footer-magnetic-item", 0.3);

      // Create scene for advanced animations
      createScene(
        ".footer-container",
        [
          {
            element: ".footer-col",
            props: {
              x: 0,
              rotation: 0,
              transformOrigin: "center center",
            },
          },
          {
            element: ".footer-copyright",
            props: {
              x: 0,
              rotation: 0,
              transformOrigin: "center center",
            },
            position: "-=0.3",
          },
        ],
        {
          start: "top 60%",
          end: "bottom 40%",
          scrub: true,
          markers: false,
        },
      );

      // Add hover effects like those in Bento.astro
    }

    // Add parallax scroll effect
    ScrollTrigger.create({
      trigger: footerSection,
      start: "top bottom",
      end: "bottom bottom",
      scrub: true,
      onUpdate: (self) => {
        const yPos = (1 - self.progress) * 30; // Move up as it enters viewport
        gsap.to(".footer-container", {
          y: yPos,
          ease: "none",
          overwrite: "auto",
        });
      },
    });
  });
</script>

<style>
  .footer-section {
    position: relative;
    will-change: transform;
  }

  .footer-container {
    will-change: transform, clip-path, opacity, visibility;
  }

  .footer-scroll-reveal {
    will-change: transform, opacity;
    transition: box-shadow 0.3s ease-in-out;
  }

  .char-span {
    display: inline-block;
    will-change: transform, opacity;
  }

  .footer-logo img {
    will-change: transform;
    transition: transform 0.3s ease-in-out;
  }

  .footer-logo:hover img {
    transform: scale(1.1);
  }

  /* Add subtle hover effect on card borders like in Bento */
  .footer-col {
    position: relative;
    overflow: hidden;
    will-change: transform;
  }

  .footer-col:hover::before {
    opacity: 0.5;
  }

  .footer-col::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(var(--accent-primary-rgb, 0, 0, 204), 0.3),
      transparent
    );
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
  }

  .footer-col:hover::after {
    opacity: 1;
  }

  /* Enhanced responsive styles */

  /* Mobile-only: Single column layout */
  @media (max-width: 639px) {
    .footer-grid {
      gap: 0;
    }

    .footer-col {
      border-right: none !important;
      border-bottom: 1px solid var(--border-color);
    }

    .footer-col:last-child {
      border-bottom: none;
    }
  }

  /* Extra small screens (< 475px) */
  @media (max-width: 474px) {
    .footer-container {
      width: 95%;
    }

    /* .footer-col {
      padding: 12px !important;
    } */

    .footer-heading {
      font-size: 14px !important;
      margin-bottom: 8px !important;
    }

    .footer-link,
    .footer-desc {
      font-size: 12px !important;
    }

    .footer-dialogh-header {
      flex-direction: column !important;
      align-items: flex-start !important;
      gap: 8px !important;
    }

    .footer-dialogh-links {
      flex-direction: column !important;
      align-items: flex-start !important;
      gap: 8px !important;
    }

    .footer-copyright {
      flex-direction: column !important;
      gap: 8px !important;
    }
  }

  /* Small mobile screens (475px - 639px) */
  @media (min-width: 475px) and (max-width: 639px) {
    .footer-grid .footer-col:nth-child(3) .flex.flex-col.sm\\:flex-row {
      flex-direction: column !important;
      align-items: flex-start !important;
      gap: 8px !important;
    }
  }

  /* Tablet adjustments (640px - 1023px) */
  @media (min-width: 640px) and (max-width: 1023px) {
    .footer-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .footer-col:nth-child(1) {
      border-right: 1px solid var(--border-color);
      border-bottom: 1px solid var(--border-color);
    }

    .footer-col:nth-child(2) {
      border-bottom: 1px solid var(--border-color);
    }

    .footer-col:nth-child(3) {
      border-right: 1px solid var(--border-color);
    }

    .footer-col:nth-child(4) {
      /* No additional borders needed */
    }
  }

  /* Large screens and up */
  @media (min-width: 1024px) {
    .footer-grid {
      grid-template-columns: repeat(4, 1fr);
    }

    .footer-col:not(:last-child) {
      border-right: 1px solid var(--border-color);
    }
  }

  /* Fix for grid spacing on very small screens */
  @media (max-width: 374px) {
    .footer-links.grid-cols-1 {
      gap: 6px;
    }

    .footer-links.grid-cols-2 {
      grid-template-columns: 1fr;
      gap: 6px;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .footer-container {
      opacity: 1;
      clip-path: none;
    }

    .footer-scroll-reveal {
      transition: none !important;
      transform: none !important;
    }
  }
</style>
